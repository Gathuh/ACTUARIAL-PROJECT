"0",""
"0","time_intervals=seq(0,max(data$Duration),by=2)"
"0","diff=diff(time_intervals)[1]"
"0",""
"0","at_risk <- numeric(length(time_intervals))"
"0","events <- numeric(length(time_intervals))"
"0","censored <- numeric(length(time_intervals))"
"0","adjusted_at_risk <- numeric(length(time_intervals))"
"0","survival_prob <- numeric(length(time_intervals))"
"0","cumulative_survival <- 1"
"0",""
"0","# Calculate actuarial estimates"
"0","for (i in seq_along(time_intervals)) {"
"0","  start_time <- time_intervals[i]"
"0","  end_time <- start_time + diff  "
"0","  # Number of individuals at risk at the start of the interval"
"0","  at_risk[i] <- sum(data$Duration >= start_time)"
"0","  "
"0","  # Number of events (deaths) in this interval"
"0","  events[i] <- sum(data$Duration >= start_time & data$Duration < end_time & data$event == 1)"
"0","  "
"0","  # Number of censored observations in this interval"
"0","  censored[i] <- sum(data$Duration >= start_time & data$Duration < end_time & data$event == 0)"
"0","  "
"0","  # Adjusted number at risk"
"0","  adjusted_at_risk[i] <- at_risk[i] - censored[i] / 2"
"0","  "
"0","  # Survival probability for this interval"
"0","  if (adjusted_at_risk[i] > 0) {"
"0","    interval_survival <- 1 - events[i] / adjusted_at_risk[i]"
"0","  } else {"
"0","    interval_survival <- 1"
"0","  }"
"0","  "
"0","  # Cumulative survival probability"
"0","  cumulative_survival <- cumulative_survival * interval_survival"
"0","  survival_prob[i] <- cumulative_survival"
"0","}"
"0",""
"0","# Combine results into a data frame"
"0","actuarial_results <- data.frame("
"0","  Time_Interval = paste(time_intervals, time_intervals + diff, sep = ""-""),"
"0","  At_Risk = at_risk,"
"0","  Events = events,"
"0","  Censored = censored,"
"0","  Adjusted_At_Risk = adjusted_at_risk,"
"0","  Survival_Probability = survival_prob"
"0",")"
"0",""
"0","a=actuarial_results$Events/(actuarial_results$Adjusted_At_Risk*(actuarial_results$Adjusted_At_Risk - actuarial_results$Events))"
"0",""
"0","for(i in seq_along(time_intervals)){"
"0","  actuarial_results$se=sqrt((actuarial_results$Survival_Probability**2)*sum(a))"
"0",""
"0","}"
"0",""
"0","# Print the results"
"0","actuarial_results$low_95=actuarial_results$Survival_Probability-qnorm(0.95,lower.tail = T)*actuarial_results$se"
"0","actuarial_results$up_95=actuarial_results$Survival_Probability+qnorm(0.95,lower.tail = T)*actuarial_results$se"
"0",""
"0","actuarial_results %>% filter(Events!=0)"
